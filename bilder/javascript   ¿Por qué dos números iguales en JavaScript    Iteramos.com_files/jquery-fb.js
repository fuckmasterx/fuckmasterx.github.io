(function(factory){if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else if(typeof exports==='object'){factory(require('jquery'));}else{factory(jQuery);}}(function($){$.extend({fblogin:function(options){var __,isSdkLoaded,isFbInitiated,$dfd;options=options||{};isSdkLoaded=false;isFbInitiated=false;$dfd=$.Deferred();__={init:function(){if(!options.fbId){throw new Error('Required option "fbId" is missing!');}
options.permissions=options.permissions||'';options.fields=options.fields||'';options.success=options.success||function(){};options.error=options.error||function(){};__.listenForFbAsync();},listenForFbAsync:function(){if(window.fbAsyncInit){var notMyFunction=window.fbAsyncInit;}
window.fbAsyncInit=function(){__.initFB();isSdkLoaded=true;if(notMyFunction){notMyFunction();}};if(isSdkLoaded||window.FB){window.fbAsyncInit();return;}},initFB:function(){if(!isFbInitiated){window.FB.init({appId:options.fbId,cookie:true,xfbml:true,version:'v2.0'});isFbInitiated=true;}
$dfd.notify({status:'init.fblogin'});},loginToFB:function(){window.FB.login(function(response){if(response.authResponse){$dfd.notify({status:'authenticate.fblogin',data:response});}else{$dfd.reject({error:{message:'User cancelled login or did not fully authorize.'}});}},{scope:options.permissions,return_scopes:true});},getFbFields:function(accessToken){FB.api('/me',{fields:options.fields},function(response){if(response&&!response.error){$dfd.resolve(response);}
else{$dfd.reject(response);}});}};$dfd.progress(function(response){if(response.status==='init.fblogin'){__.loginToFB();}else if(response.status==='authenticate.fblogin'){__.getFbFields(response.data.authResponse.accessToken);}else{dfd.reject();}});$dfd.done(options.success);$dfd.fail(options.error);__.init();return $dfd;}});}));